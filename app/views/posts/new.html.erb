<% if flash[:warning] %>
    <p class="alert alert-danger"><%= flash[:warning] %></p>
<% end %>

<div class="container">
    <div class="row">
        <div class="col-md-offset-3 col-md-8">
            <h1>新規投稿</h1>
            <br>
            <br>
            <div class="images-field clearfix">
                <%= form_with model: @post, local: true  do |f| %>
                    <div class="form_area">
                        <label>行ったお店</label>
                        <%= f.radio_button :status, :report %>
                        <label>行きたいお店</label>
                        <%= f.radio_button :status, :list %>
                        <br>
                        <label>レポート写真</label>
                        <%= f.file_field :images, multiple: true, class: "file-input", id: :imgInp %>
                        <output id="list"></output>
                    </div>
                    <br>
                    <div class="form_area">
                        <label>タイトル</label>
                        <%= f.text_field :title %><br>
                        <label>本文</label>
                        <%= f.text_area :body %><br>
                        <label>利用日</label>
                        <%= f.date_field :used_at %><br>
                        <label>店名</label>
                        <%= f.text_field :shop_name %><br>
                        <label>住所</label>
                        <%= f.text_field :shop_address %><br>
                        <label>URL</label>
                        <%= f.text_field :url %><br>
                        <label>価格帯</label>
                        <%= f.collection_select :price_id, Price.all, :id, :price_range %><br>
                        <%= f.submit "投稿" %>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
</div>

<style>
    .reader_file {
        /*float: left;*/
    }
    .reader_image {
        /*float: left;*/
        width: 300px;
        height: 300px;
    }
    .form_area {
        float: left;
        margin-right: 50px;
    }
</style>

<script>
    document.getElementById('imgInp').onchange = function(event) {
        initializeFiles();

        var files = event.target.files;

        for (var i = 0, f; f = files[i]; i++) {
            var reader = new FileReader();
            // var size = f.size;
            // var limit = 50000;

            // if ( limit < size ) {
            //     alert('500KBを超えています。500KB以下のファイルを選択してください。');
            //     f.value = '';
            //     return;
            // }

            reader.readAsDataURL(f);

            reader.onload = (function(theFile) {
                return function(e) {
                    var div = document.createElement('div');
                    div.className = 'reader_file';
                    div.innerHTML = '<div class="reader_title">' + encodeURIComponent(theFile.name) + '</div>';
                    div.innerHTML += '<img class="reader_image" src="' + e.target.result + '" />';
                    document.getElementById('list').insertBefore(div, null);
                }
            })(f);
        }
    };

    function initializeFiles() {
        document.getElementById('list').innerHTML = '';
    }

// $(function(){
//   //画像ファイルプレビュー表示のイベント追加 fileを選択時に発火するイベントを登録
//   $('form').on('change', 'input[type="file"]', function(e) {
//     var file = e.target.files[0],
//         reader = new FileReader(),
//         $preview = $(".preview");
//         t = this;

//     // 画像ファイル以外の場合は何もしない
//     if(file.type.indexOf("image") < 0){
//       return false;
//     }

//     // ファイル読み込みが完了した際のイベント登録
//     reader.onload = (function(file) {
//       return function(e) {
//         //既存のプレビューを削除
//         $preview.empty();
//         // .prevewの領域の中にロードした画像を表示するimageタグを追加
//         $preview.append($('<img>').attr({
//                   src: e.target.result,
//                   width: "150px",
//                   class: "preview",
//                   title: file.name
//               }));
//       };
//     })(file);

//     reader.readAsDataURL(file);
//   });
// });
</script>